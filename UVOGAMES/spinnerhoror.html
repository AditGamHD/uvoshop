<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; style-src 'self' 'unsafe-inline'; media-src 'self' https: blob:; img-src 'self' https: data:;">
    <title>SPINERHOROR V2</title>
    <style>
        :root {
            --bg-dark: #050505;
            --bg-panel: #121212;
            --accent: #d32f2f;
            --text-main: #e0e0e0;
            --font-stack: 'Courier New', Courier, monospace; /* Font lebih horror/retro */
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-stack);
            overflow: hidden;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- UTILITY & ANIMATIONS --- */
        .hidden { display: none !important; }
        
        .full-screen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 10;
            background: var(--bg-dark); /* Ensure background covers previous screens */
        }

        /* --- UI COMPONENTS --- */
        .panel {
            background: var(--bg-panel);
            border: 2px solid #333;
            padding: 20px;
            border-radius: 8px;
            width: 95%; max-width: 500px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        h1 { color: var(--accent); letter-spacing: 5px; text-shadow: 0 0 10px var(--accent); margin-top: 0; }
        h2 { font-size: 1.2rem; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; }

        /* INPUTS */
        .input-row { margin-bottom: 10px; text-align: left; }
        input, select {
            background: #000; border: 1px solid #444; color: #fff;
            padding: 10px; width: 100%; font-family: inherit; margin-top: 5px;
        }

        /* BUTTONS & FOCUS */
        .btn {
            background: #222; border: 2px solid #444; color: #fff;
            padding: 15px 30px; font-size: 1.2rem; cursor: pointer;
            margin: 10px; display: inline-block; width: 80%;
            text-transform: uppercase; font-weight: bold;
            transition: 0.2s;
        }

        /* INI PENTING: Style saat tombol dipilih pakai keyboard/panah */
        .active-focus {
            border-color: var(--accent) !important;
            background-color: #300 !important;
            color: var(--accent) !important;
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--accent);
            outline: none;
        }

        /* GAME HUD */
        #hud {
            position: absolute; top: 10px; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;
            padding: 0 10px; z-index: 20;
        }
        .p-badge {
            font-size: 0.7rem; padding: 4px 8px; border: 1px solid #444; background: #000;
            border-radius: 4px; opacity: 0.5;
        }
        .p-badge.active { opacity: 1; border-color: #fff; transform: scale(1.1); box-shadow: 0 0 10px #fff; }
        .p-badge.dead { text-decoration: line-through; color: #555; border-color: transparent; }

        /* SPINNER */
        #spinner-wrap { margin: 20px auto; width: 150px; height: 150px; position: relative; }
        #wheel {
            width: 100%; height: 100%; border-radius: 50%; border: 4px solid #fff;
            background: conic-gradient(#111 0 90deg, #d32f2f 90deg 180deg, #111 180deg 270deg, #d32f2f 270deg 360deg);
            transition: transform 3s cubic-bezier(0.1,0.7,0.1,1);
        }
        #arrow {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid #fff;
            z-index: 5;
        }

        /* CARDS */
        #card-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            margin-top: 20px;
        }
        .card {
            background: #222; border: 2px solid #555; aspect-ratio: 3/4;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; cursor: pointer; transition: 0.2s;
            position: relative;
        }
        .card.flipped { background: #000; border-color: #111; pointer-events: none; }
        .card.safe { background: #1b5e20; border-color: #2e7d32; } /* Green */
        .card.dead { background: #b71c1c; border-color: #ff0000; } /* Red */

        /* NOTIFICATIONS */
        #toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95); border: 2px solid var(--accent);
            padding: 20px; font-size: 1.5rem; text-align: center;
            z-index: 9999; display: none; color: #fff; width: 80%;
            box-shadow: 0 0 50px #000;
        }

        /* JUMPSCARE */
        #scare-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: none;
            justify-content: center; align-items: center;
        }
        #scare-img { width: 100%; height: 100%; object-fit: cover; }

        /* CONTROLS (HP) */
        #mobile-controls {
            position: fixed; bottom: 20px; left: 0; width: 100%; height: 120px;
            display: flex; justify-content: space-between; padding: 0 30px;
            z-index: 100; pointer-events: none;
        }
        @media (min-width: 1024px) { #mobile-controls { display: none; } }

        .d-pad { pointer-events: auto; width: 120px; height: 120px; position: relative; }
        .d-btn {
            position: absolute; width: 40px; height: 40px; background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3); color: white; display: grid; place-items: center;
            cursor: pointer; backdrop-filter: blur(5px);
        }
        .d-btn:active { background: var(--accent); }
        .d-up { top: 0; left: 40px; } .d-down { bottom: 0; left: 40px; }
        .d-left { top: 40px; left: 0; } .d-right { top: 40px; right: 80px; } /* Corrected right pos */

        .act-btn {
            pointer-events: auto; width: 80px; height: 80px; border-radius: 50%;
            background: rgba(211, 47, 47, 0.4); border: 2px solid var(--accent);
            display: grid; place-items: center; color: #fff; font-weight: bold; margin-top: 20px;
        }
        .act-btn:active { background: var(--accent); }

    </style>
</head>
<body>

    <div id="toast">INFO</div>

    <div id="scare-overlay">
        <img id="scare-img" src="">
    </div>

    <section id="s-menu" class="full-screen">
        <div class="panel">
            <h1>SPINER HORROR</h1>
            <p>High Security | No Emoji | CSS Only</p>
            <button class="btn focus-target" onclick="gotoSetup()">PLAY</button>
            <button class="btn focus-target" onclick="showCredit()">CREDIT</button>
        </div>
    </section>

    <section id="s-setup" class="full-screen hidden">
        <div class="panel">
            <h2>SETUP PLAYER</h2>
            <div class="input-row">
                <label>Jumlah Player (1-10):</label>
                <input type="number" id="p-count" value="2" min="1" max="10" class="focus-target">
            </div>
            <button class="btn focus-target" onclick="initGame()">START GAME</button>
            <button class="btn focus-target" onclick="gotoMenu()">BACK</button>
        </div>
    </section>

    <section id="s-game" class="full-screen hidden">
        <div id="hud"></div>
        <div class="panel">
            <h2 id="status-text">Player 1 Turn</h2>
            
            <div id="area-spin">
                <div id="spinner-wrap">
                    <div id="arrow"></div>
                    <div id="wheel"></div>
                </div>
                <button id="btn-spin" class="btn focus-target" onclick="doSpin()">PUTAR</button>
            </div>

            <div id="area-card" class="hidden">
                <p id="pick-instruction">Pilih Kartu!</p>
                <div id="card-grid"></div>
            </div>
        </div>
    </section>

    <section id="s-credit" class="full-screen hidden">
        <div class="panel">
            <h2>CREDIT</h2>
            <p>Developer By:</p>
            <h1 style="font-size: 2rem;">ADITdeveloper</h1>
            <button class="btn focus-target" onclick="gotoMenu()">BACK</button>
        </div>
    </section>

    <div id="mobile-controls">
        <div class="d-pad">
            <div class="d-btn d-up" onclick="moveFocus(-2)">▲</div>
            <div class="d-btn d-down" onclick="moveFocus(2)">▼</div>
            <div class="d-btn d-left" onclick="moveFocus(-1)">◀</div>
            <div class="d-btn d-right" onclick="moveFocus(1)">▶</div>
        </div>
        <div class="act-btn" onclick="triggerEnter()">OK</div>
    </div>

    <script>
        // --- DATA GAME ---
        const Game = {
            players: [],
            turn: 0,
            phase: 'menu', // menu, setup, spin, pick
            cardsToPick: 1
        };

        const ASSETS = {
            // Ganti link ini jika ingin custom
            img: "https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbW5wbDNzbG94ZnJ0Y3ZqNm5wbDNzbG94ZnJ0Y3ZqNm5wbDNzbG94ZnJ0Y3ZqJmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/14ut8PhnIwzros/giphy.gif",
            audio: "https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/theme_01.mp3"
        };

        // --- SISTEM NAVIGASI (FIXED) ---
        let focusEls = [];
        let focusIdx = 0;

        function refreshFocus() {
            // Cari elemen interaktif HANYA di layar yang terlihat
            const activeScreen = document.querySelector('.full-screen:not(.hidden)');
            if(!activeScreen) return;

            // Cari tombol, input, dan kartu yang belum dibuka
            const targets = activeScreen.querySelectorAll('.focus-target, .card:not(.flipped)');
            focusEls = Array.from(targets);
            
            // Reset index jika out of bound
            if(focusIdx >= focusEls.length) focusIdx = 0;
            if(focusEls.length > 0) {
                applyFocus();
            }
        }

        function applyFocus() {
            // Hapus class lama
            document.querySelectorAll('.active-focus').forEach(el => el.classList.remove('active-focus'));
            
            if(focusEls[focusIdx]) {
                focusEls[focusIdx].classList.add('active-focus');
                focusEls[focusIdx].focus();
            }
        }

        function moveFocus(step) {
            if(focusEls.length === 0) return;
            
            // Logic khusus untuk Grid Kartu (4 kolom)
            // Jika di area kartu, panah atas/bawah lompat 4
            const isCardGrid = document.getElementById('area-card').classList.contains('hidden') === false;
            
            if(isCardGrid && Math.abs(step) === 2) {
                // Mapping: -2 (Atas) jadi -4, 2 (Bawah) jadi +4
                step = step === 2 ? 4 : -4;
            }

            focusIdx += step;

            // Loop / Wrap around
            if(focusIdx < 0) focusIdx = focusEls.length - 1;
            if(focusIdx >= focusEls.length) focusIdx = 0;

            applyFocus();
        }

        function triggerEnter() {
            if(focusEls[focusIdx]) {
                focusEls[focusIdx].click();
            }
        }

        // Listener Keyboard PC
        document.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowUp') moveFocus(-2); // Pakai logika -2 sebagai 'atas' umum
            if(e.key === 'ArrowDown') moveFocus(2);
            if(e.key === 'ArrowLeft') moveFocus(-1);
            if(e.key === 'ArrowRight') moveFocus(1);
            if(e.key === 'Enter') triggerEnter();
        });

        // --- FUNGSI LAYAR ---
        function showScreen(id) {
            document.querySelectorAll('.full-screen').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            
            // Delay sedikit agar DOM render dulu baru cari fokus
            setTimeout(() => {
                focusIdx = 0;
                refreshFocus();
            }, 100);
        }

        function gotoMenu() { showScreen('s-menu'); }
        function gotoSetup() { showScreen('s-setup'); }
        function showCredit() { showScreen('s-credit'); }

        // --- GAME LOGIC ---
        function initGame() {
            const count = parseInt(document.getElementById('p-count').value) || 2;
            Game.players = [];
            for(let i=0; i<count; i++) {
                Game.players.push({ id: i+1, name: "P"+(i+1), active: true, color: getRandomColor() });
            }
            Game.turn = 0;
            renderHud();
            startGameLoop();
        }

        function renderHud() {
            const h = document.getElementById('hud');
            h.innerHTML = '';
            Game.players.forEach((p, idx) => {
                const b = document.createElement('div');
                b.className = `p-badge ${p.active ? '' : 'dead'} ${idx === Game.turn ? 'active' : ''}`;
                b.innerText = p.name;
                b.style.borderLeft = `5px solid ${p.color}`;
                h.appendChild(b);
            });
        }

        function startGameLoop() {
            showScreen('s-game');
            nextTurn();
        }

        function nextTurn() {
            // Cari player yang masih hidup
            let loopCount = 0;
            while(!Game.players[Game.turn].active) {
                Game.turn = (Game.turn + 1) % Game.players.length;
                loopCount++;
                if(loopCount > 20) { // Cek menang
                     alert("WINNER FOUND"); location.reload(); return;
                }
            }
            
            // Cek jika cuma 1 orang tersisa
            const survivors = Game.players.filter(p => p.active);
            if(survivors.length === 1) {
                showToast(`PEMENANG: ${survivors[0].name}`, true);
                setTimeout(() => location.reload(), 3000);
                return;
            }

            renderHud();
            // Reset Tampilan ke Spinner
            document.getElementById('area-spin').classList.remove('hidden');
            document.getElementById('area-card').classList.add('hidden');
            document.getElementById('status-text').innerText = `GILIRAN ${Game.players[Game.turn].name}`;
            document.getElementById('wheel').style.transform = 'rotate(0deg)';
            document.getElementById('btn-spin').disabled = false;
            
            refreshFocus();
        }

        function doSpin() {
            const btn = document.getElementById('btn-spin');
            btn.disabled = true;
            
            const deg = 720 + Math.floor(Math.random() * 360);
            document.getElementById('wheel').style.transform = `rotate(${deg}deg)`;
            
            // Simulasi hasil (acak 1 atau 2 kartu)
            setTimeout(() => {
                const pick = Math.random() > 0.5 ? 2 : 1;
                Game.cardsToPick = pick;
                showToast(`AMBIL ${pick} KARTU!`);
                setTimeout(() => setupCards(), 2000);
            }, 3000);
        }

        function setupCards() {
            document.getElementById('area-spin').classList.add('hidden');
            document.getElementById('area-card').classList.remove('hidden');
            document.getElementById('pick-instruction').innerText = `Pilih ${Game.cardsToPick} Kartu Hati-hati!`;
            
            const grid = document.getElementById('card-grid');
            grid.innerHTML = '';

            // Buat 4 kartu (3 aman, 1 hitam)
            let types = ['safe', 'safe', 'safe', 'dead'];
            types.sort(() => Math.random() - 0.5);

            types.forEach(type => {
                const c = document.createElement('div');
                c.className = 'card'; // Default class
                c.innerHTML = '?';
                c.onclick = () => openCard(c, type);
                grid.appendChild(c);
            });

            refreshFocus();
        }

        function openCard(el, type) {
            if(el.classList.contains('flipped')) return;
            
            el.classList.add('flipped');
            el.classList.add(type);
            el.innerHTML = type === 'safe' ? 'O' : 'X';

            if(type === 'dead') {
                doJumpscare();
            } else {
                Game.cardsToPick--;
                if(Game.cardsToPick <= 0) {
                    showToast("SELAMAT!");
                    setTimeout(nextTurn, 1500);
                } else {
                    document.getElementById('pick-instruction').innerText = "Pilih 1 Lagi...";
                }
            }
        }

        function doJumpscare() {
            const ov = document.getElementById('scare-overlay');
            const img = document.getElementById('scare-img');
            const aud = new Audio(ASSETS.audio);
            
            img.src = ASSETS.img;
            ov.style.display = 'flex';
            aud.play().catch(e => console.log("Audio block"));

            setTimeout(() => {
                ov.style.display = 'none';
                Game.players[Game.turn].active = false;
                showToast("TERELIMINASI!");
                Game.turn = (Game.turn + 1) % Game.players.length;
                setTimeout(nextTurn, 2000);
            }, 2500);
        }

        function showToast(msg, isWin = false) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            t.style.borderColor = isWin ? 'green' : 'red';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function getRandomColor() {
            return '#' + Math.floor(Math.random()*16777215).toString(16);
        }

        // Mulai Focus awal
        refreshFocus();
    </script>
</body>
</html>
